import os
import sys
import shutil
import fileinput
import click
import markdown

cwd = os.getcwd()

@click.group()
def cli():
    """Blended: Static Website Generator"""

@cli.command('init', short_help='Initiate a new website')
def init():
    """Initiates a new website"""
    print("Blended: Static Website Generator -\n")
    wtype = raw_input("Website Type (html, md): ")
    wname = raw_input("Website Name: ")
    wdesc = raw_input("Website Description: ")
    wlic = raw_input("Website License: ")
    aname = raw_input("Author(s) Name(s): ")
    wlan = raw_input("Website Language: ")

    templ_dir = os.path.join(cwd, "templates")
    if not os.path.exists(templ_dir):
        os.makedirs(templ_dir)

    cont_dir = os.path.join(cwd, "content")
    if not os.path.exists(cont_dir):
        os.makedirs(cont_dir)

    build_dir = os.path.join(cwd, "build")
    if not os.path.exists(build_dir):
        os.makedirs(build_dir)
    
    conf_file_dir = os.path.join(cwd, "conf.py")
    conf_file = open(conf_file_dir, "w")
    conf_file.write('# Configuration is atuomatically generated by Blended, feel free to edit any values\n\n')
    conf_file.write('website_type = "'+wtype+'"\n')
    conf_file.write('website_name = "'+wname+'"\n')
    conf_file.write('website_description = "'+wdesc+'"\n')
    conf_file.write('website_license = "'+wlic+'"\n')
    conf_file.write('author_name = "'+aname+'"\n')
    conf_file.write('website_language = "'+wlan+'"\n')
    conf_file.write('\n')
    conf_file.close()
    
    print("\nThe required files for your website have been generated.")

@cli.command('purge', short_help='Purge the Blended files')
def purge():
    """Initiates a new website"""
    print("Purging the Blended files!")

    templ_dir = os.path.join(cwd, "templates")
    if os.path.exists(templ_dir):
        shutil.rmtree(templ_dir)

    cont_dir = os.path.join(cwd, "content")
    if os.path.exists(cont_dir):
        shutil.rmtree(cont_dir)

    build_dir = os.path.join(cwd, "build")
    if os.path.exists(build_dir):
        shutil.rmtree(build_dir)
    
    conf_file_dir = os.path.join(cwd, "conf.py")
    if os.path.exists(conf_file_dir):
        os.remove(conf_file_dir)

@cli.command('build', short_help='Build the Blended files into a website')
def build():
    """Blends the generated files and outputs a html website"""

    conf_file_dir = os.path.join(cwd, "conf.py")
    if not os.path.exists(conf_file_dir):
        sys.exit("Configuration file not found! Have you run the init command?")
    else:
        sys.path.insert(0, cwd)
        from conf import website_type, website_name, website_description, author_name, website_language
        print("Building your Blended files into a website!")

    build_dir = os.path.join(cwd, "build")
    if not os.path.exists(build_dir):
        os.makedirs(build_dir)
    
    if website_type == "html":
        home_templ_dir = os.path.join(cwd, "templates", "home.html")
        if os.path.exists(home_templ_dir):
            print("hi")

    print("The files are built! You can find them in the build/ directory")

if __name__ == '__main__':
    cli()
